- hosts: Docker
   become: true
   tasks:
   - name: Transfer the app code to Docker
     copy:
       src=/home/ansible/maven-web-app.war
       dest=/home/ansible
     ignore_errors: yes

   - name: stop if we have old docker container.
     command: docker stop java-app
     ignore_errors: yes

   - name: remove stopped docker container
     command: docker rm java-app
     ignore_errors: yes

   - name: building docker image
     command: docker rmi app-image:1
     args:
       chdir: /home/ansible

   - name: Creating Docker Container
     command: docker run -d --name java-app -p 90000:8080 app-image:1
     ignore_errors: yes

   - name: deploying app as a docker container
            docker_container:
              name: java-app
              image: mylandmarktech/spring-boot-mongo
              state: present
              recreate: yes
              port:
                - "8080:8080"
            ignore_errors: yes
